name: Update plots

on:
 #   push:
 #       branches:
 #           - main
    schedule:
        - cron: '0 */6 * * *'
    workflow_dispatch:

jobs:
    update-plots:
        runs-on: ubuntu-latest

        steps:
            - uses: actions/checkout@v2

            - name: Set up python 3.7.9
              uses: actions/setup-python@v2
              with:
                  python-version: 3.7.9
                  
            - name: Get pip cache dir
              id: pip-cache
              run: |
                echo "::set-output name=dir::$(pip cache dir)"
            - name: Cache pip
              uses: actions/cache@v2
              with:
                path: ${{ steps.pip-cache.outputs.dir }}
                key: ${{ runner.os }}-pip-${{ hashFiles('**/requirements.txt') }}
                restore-keys: |
                  ${{ runner.os }}-pip-
                  
            - name: Install requirements
              run: |
                  python -m pip install --upgrade pip
                  if [ -f requirements.txt ]; then pip install -r requirements.txt; fi

            - name: Generate plots
              env: 
                  AWS_ACCESS_KEY_ID: ${{ secrets.AWS_ACCESS_KEY_ID }}
                  AWS_SECRET_ACCESS_KEY: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
                  S3_BUCKET_NAME: ${{ secrets.S3_BUCKET_NAME }}
              run: |
                  python fetch.py

